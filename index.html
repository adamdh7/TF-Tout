<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <title>Adam_D'H7</title>

  <!-- Font Awesome pour icônes sociales -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/jpeg" href="https://res.cloudinary.com/dckwrqrur/image/upload/v1757205404/tf-stream-url/Screenshot_20250906_202106_Chrome_go9vhu.jpg" />
  <link rel="apple-touch-icon" href="https://res.cloudinary.com/dckwrqrur/image/upload/v1757205404/tf-stream-url/Screenshot_20250906_202106_Chrome_go9vhu.jpg" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --card-max-width:920px;
      --card-min-height:80px;
      --card-max-height:80vh;
    }
    html,body{height:100%;}
    body{
      margin:0;
      background:#000;
      color:#fff;
      font-family:'Roboto',sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding-bottom:60px;
    }

    .header{
      padding:18px 16px;
      text-align:center;
      position:sticky;
      top:0;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,0.7);
      z-index:10;
    }
    .logo{ font-size:26px; font-weight:700; background:linear-gradient(90deg,#fff,#000); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .search-container{ display:flex; justify-content:center; padding:8px 20px; }
    .search-box{ width:100%; max-width:500px; background:#1c1c1e; border:none; padding:10px 14px; border-radius:12px; color:#fff; font-size:15px; outline:none; }

    #explorerView{ padding:18px; max-height:calc(100vh - 120px); overflow-y:auto; background:#000; -webkit-overflow-scrolling:touch; }

    .post-card{ background:#111; border-radius:14px; padding:14px; margin-bottom:18px; box-shadow:0 2px 8px rgba(0,0,0,0.7); }
    .post-name{ font-weight:700; font-size:16px; margin:8px 0; color:#fff; text-align:left; }
    .post-text{ font-size:14px; color:#ddd; margin-bottom:10px; white-space:pre-wrap; text-align:left; }
    .post-desc{ font-size:13px; color:#ccc; margin-top:8px; text-align:left; }

    .media-wrap{ text-align:center; margin: 0 0 10px 0; }

    .post-thumb-container {
      position:relative;
      display:inline-block;
      box-sizing:border-box;
      max-width:var(--card-max-width);
      width:auto;
      background:#000;
      border-radius:12px;
      overflow:hidden;
      padding:0;
      box-shadow: inset 0 0 18px rgba(0,0,0,0.45), 0 6px 18px rgba(0,0,0,0.6);
      min-height:var(--card-min-height);
      max-height:var(--card-max-height);
    }

    .post-thumb,
    .post-thumb img,
    .post-thumb video,
    .post-thumb iframe,
    .video-inline-container > img,
    .video-inline-container > video {
      display:block;
      width:auto;
      max-width:100%;
      height:auto;
      max-height:calc(var(--card-max-height));
      object-fit:contain;
      background:#000;
      border-radius:0;
    }

    .post-thumb iframe, .post-thumb video { display:block; width:100%; height:auto; }

    .social-section{
      margin-top:10px;
      padding-top:10px;
      border-top:1px solid #333;
      display:flex;
      justify-content:center;
      gap:18px;
      flex-wrap:wrap;
    }
    .social-section a{ color:#fff; text-decoration:none; display:inline-flex; align-items:center; justify-content:center; width:44px; height:44px; border-radius:10px; background:rgba(255,255,255,0.03); }
    .social-section a:hover{ background:rgba(255,255,255,0.06); transform:translateY(-2px); transition:all .15s ease; }
    .social-section i{ font-size:18px; }

    .ad-overlay{ position:fixed; inset:0; background:rgba(0,0,0,0.9); display:none; justify-content:center; align-items:center; z-index:1000; }
    .ad-container{ position:relative; max-width:90%; width:100%; height:80%; background:#111; padding:0; border-radius:10px; overflow:hidden; }
    .ad-container iframe{ width:100%; height:100%; border:none; }
    .skip-btn{ position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.5); border:none; color:#fff; padding:8px 12px; border-radius:6px; cursor:pointer; display:none; z-index:1001; }

    #miniAd{ position:fixed; bottom:10px; left:10px; width:120px; height:90px; background:#111; border:1px solid #444; border-radius:8px; overflow:hidden; z-index:1001; cursor:pointer; }
    #miniAd iframe{ width:100%; height:100%; border:none; pointer-events:none; }
    #miniAd button{ position:absolute; top:2px; right:2px; background:rgba(0,0,0,0.5); border:none; color:#fff; font-size:12px; cursor:pointer; padding:2px 4px; border-radius:4px; }

    @media (max-width:600px){
      :root{ --card-max-width:100%; --card-max-height:70vh; --card-min-height:80px; }
      .post-card{ padding:12px; border-radius:12px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">Adam_D'H7</div>
    <div class="search-container">
      <input id="searchBox" class="search-box" placeholder="Rechèch..." oninput="filterSearch(this.value)">
    </div>
  </div>

  <div id="explorerView" role="main" aria-live="polite"></div>

  <!-- Pré-roll vidéo (overlay) -->
  <div id="adOverlay" class="ad-overlay" aria-hidden="true">
    <div class="ad-container" role="dialog" aria-label="Publicité">
      <iframe id="prerollFrame" src="" allow="autoplay; fullscreen"></iframe>
      <button id="skipBtn" class="skip-btn" onclick="closeAd()">Ignorer la pub</button>
    </div>
  </div>

  <!-- Mini ad clickable -->
  <div id="miniAd" aria-hidden="false" title="Voir la pub">
    <button id="closeMiniAd" aria-label="Changer pub">×</button>
    <iframe id="miniAdFrame" src="" allowfullscreen></iframe>
  </div>

  <script>
    const AD_REDIRECT_URL = "https://www.revenuecpmgate.com/jhf4rw2iqm?key=7fbc359e784e5a84aaff45865b68dce4";
    let adCallback = null, skipTimeout;

    // miniAd rotation
    const miniAds = [ AD_REDIRECT_URL ];
    let miniIndex = 0;
    function showNextMiniAd(){
      document.getElementById("miniAdFrame").src = miniAds[miniIndex];
      miniIndex = (miniIndex + 1) % miniAds.length;
    }
    document.getElementById("closeMiniAd").onclick = (e) => { e.stopPropagation(); showNextMiniAd(); };
    document.getElementById("miniAd").addEventListener("click", (e) => {
      if (e.target && e.target.id === "closeMiniAd") return;
      window.open(AD_REDIRECT_URL, "_blank");
    });
    setInterval(showNextMiniAd, 15000);
    showNextMiniAd();

    // ---------- POSTS LOADING & SHUFFLE ----------
    let allData = [];

    // Fisher-Yates shuffle
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Chargement: index.json doit contenir la liste des fichiers (ex: ["poste.json","poste2.json"])
    fetch("index.json")
      .then(r => r.json())
      .then(files => Promise.all(files.map(f => fetch(f).then(r => r.json()))))
      .then(jsons => {
        jsons.forEach(d => Array.isArray(d) ? allData.push(...d) : allData.push(d));
        shuffle(allData); // mélange pour ordre aléatoire à chaque refresh
        displayExplorer(allData);
      }).catch(err => {
        console.error("Erreur chargement JSON:", err);
        const ex = document.getElementById("explorerView");
        ex.innerHTML = '<div style="color:#999;padding:20px;text-align:center">Pa kapab chaje kontni (index.json).</div>';
      });

    function filterSearch(val){
      const txt = (val || "").toLowerCase();
      const filtered = allData.filter(p =>
        ((p.Catégorie || p.Categorie || p.category || "").toString().toLowerCase() === "poste") &&
        (
          (p.Texte||p.Bio||p.Info||"").toString().toLowerCase().includes(txt) ||
          (p.Name||"").toString().toLowerCase().includes(txt) ||
          (p.Description||p.Desc||"").toString().toLowerCase().includes(txt)
        )
      );
      // si tu veux rechercher avec ordre aléatoire, décommente la ligne suivante:
      // shuffle(filtered);
      displayExplorer(filtered);
    }

    function displayExplorer(data){
      const ex = document.getElementById("explorerView");
      ex.innerHTML = "";
      data.forEach((post) => {
        if (((post.Catégorie||post.Categorie||"")).toString().toLowerCase() !== "poste") return;

        const card = document.createElement("div");
        card.className = "post-card";

        // 1) Texte (corps principal) - affiché en premier
        const ptext = document.createElement("div");
        ptext.className = "post-text";
        ptext.textContent = post.Texte || post.Bio || post.Info || "";
        card.appendChild(ptext);

        // 2) Name (titre)
        const title = document.createElement("div");
        title.className = "post-name";
        title.textContent = post.Name || "";
        card.appendChild(title);

        // 3) Photo / Media
        const mediaWrap = document.createElement("div");
        mediaWrap.className = "media-wrap";

        const thumbCon = document.createElement("div");
        thumbCon.className = "post-thumb-container";

        const thumbSrc = post["Url Thumb"] || post.Previously || post.image || post.thumb || "";
        const img = document.createElement("img");
        img.className = "post-thumb";
        img.alt = post.Description || post.Name || "";
        img.loading = "lazy";
        img.src = thumbSrc || "https://via.placeholder.com/800x450?text=Preview";

        thumbCon.appendChild(img);
        mediaWrap.appendChild(thumbCon);
        card.appendChild(mediaWrap);

        // 4) Description / second texte - fallback sur Texte si vide
        const desc = document.createElement("div");
        desc.className = "post-desc";
        desc.textContent = post.Description || post.Desc || post.Texte || "";
        card.appendChild(desc);

        // click -> show pre-roll then play media inside same container
        thumbCon.addEventListener("click", (ev) => {
          ev.stopPropagation();
          const src = post.Previously || post.video || post["Url Video"] || post["Url"] || post.image || post.media || "";
          adCallback = () => playMedia(src, thumbCon);
          showAd();
        });

        ex.appendChild(card);
      });

      displaySocialLinks();
    }

    function looksLikeVideo(src){
      if (!src) return false;
      try {
        const url = src.toString().split('?')[0].toLowerCase();
        if (/\.(mp4|webm|ogg|mov|mkv)$/.test(url)) return true;
        if (src.includes("youtube.com") || src.includes("youtu.be") || src.includes("vimeo.com")) return true;
      } catch(e){}
      return false;
    }

    function normalizeYouTubeEmbed(src){
      try {
        if (src.includes("youtu.be/")) {
          const id = src.split("youtu.be/")[1].split(/[?&]/)[0];
          return "https://www.youtube.com/embed/" + id + "?autoplay=1&rel=0";
        }
        const u = new URL(src);
        const vParam = u.searchParams.get('v');
        if (vParam) return "https://www.youtube.com/embed/" + vParam + "?autoplay=1&rel=0";
      } catch(e){}
      return src;
    }

    function normalizeVimeoEmbed(src){
      try {
        const parts = src.split('/');
        const id = parts.pop() || parts.pop();
        return "https://player.vimeo.com/video/" + id + "?autoplay=1";
      } catch(e){}
      return src;
    }

    function adjustIFrameSize(iframe, container){
      try {
        const cw = container.clientWidth || iframe.clientWidth || Math.min(window.innerWidth, parseInt(getComputedStyle(container).maxWidth) || window.innerWidth);
        const h = Math.round(cw * 9 / 16);
        iframe.style.width = cw + "px";
        iframe.style.height = h + "px";
      } catch(e){}
    }
    window.addEventListener('resize', () => {
      document.querySelectorAll('.post-thumb-container iframe').forEach(iframe => {
        const container = iframe.closest('.post-thumb-container');
        if (container) adjustIFrameSize(iframe, container);
      });
    });

    // Play media inside same card; card adapts to media real size
    function playMedia(src, container){
      if (!src) return;
      container.innerHTML = "";

      const isVideo = looksLikeVideo(src);
      if (isVideo){
        if (src.includes("youtube.com") || src.includes("youtu.be")) {
          const iframe = document.createElement("iframe");
          iframe.src = normalizeYouTubeEmbed(src);
          iframe.allow = "autoplay; fullscreen; picture-in-picture";
          iframe.style.border = "none";
          iframe.style.display = "block";
          container.appendChild(iframe);
          setTimeout(() => adjustIFrameSize(iframe, container), 60);
        } else if (src.includes("vimeo.com")) {
          const iframe = document.createElement("iframe");
          iframe.src = normalizeVimeoEmbed(src);
          iframe.allow = "autoplay; fullscreen; picture-in-picture";
          iframe.style.border = "none";
          iframe.style.display = "block";
          container.appendChild(iframe);
          setTimeout(() => adjustIFrameSize(iframe, container), 60);
        } else {
          const videoEl = document.createElement("video");
          videoEl.src = src;
          videoEl.controls = true;
          videoEl.autoplay = true;
          videoEl.playsInline = true;
          videoEl.setAttribute("controlsList", "nodownload");
          videoEl.style.display = "block";
          videoEl.style.maxWidth = "100%";
          videoEl.style.height = "auto";
          videoEl.style.objectFit = "contain";
          container.appendChild(videoEl);
          videoEl.addEventListener('click', () => {
            if (videoEl.paused) videoEl.play(); else videoEl.pause();
          });
        }
      } else {
        const imgEl = document.createElement("img");
        imgEl.src = src;
        imgEl.loading = "lazy";
        imgEl.alt = "";
        imgEl.style.display = "block";
        imgEl.style.width = "auto";
        imgEl.style.maxWidth = "100%";
        imgEl.style.height = "auto";
        imgEl.style.objectFit = "contain";
        container.appendChild(imgEl);
        imgEl.addEventListener('error', () => {
          container.innerHTML = '<div style="color:#999;padding:12px;text-align:center">Imaj pa disponib</div>';
        });
      }
    }

    function displaySocialLinks(){
      const c = document.getElementById("explorerView"),
            s = document.createElement("div");
      s.className = "social-section";
      s.innerHTML = `
        <a href="https://www.facebook.com/profile.php?id=61578852256333" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fab fa-facebook-f" aria-hidden="true"></i>
        </a>
        <a href="mailto:dhaitiadam@gmail.com" rel="noopener" aria-label="Mail">
          <i class="fas fa-envelope" aria-hidden="true"></i>
        </a>
        <a href="https://whatsapp.com/channel/0029Vb6WLps7oQhWrUlyPQ2m" target="_blank" rel="noopener" aria-label="WhatsApp">
          <i class="fab fa-whatsapp" aria-hidden="true"></i>
        </a>
        <a href="https://www.instagram.com/adam_dhaiti/" target="_blank" rel="noopener" aria-label="Instagram">
          <i class="fab fa-instagram" aria-hidden="true"></i>
        </a>
        <a href="https://youtube.com/@adam_dhaiti?si=f_29jvZi6c1mJaBO" target="_blank" rel="noopener" aria-label="YouTube">
          <i class="fab fa-youtube" aria-hidden="true"></i>
        </a>
      `;
      const exists = Array.from(document.getElementsByClassName('social-section')).length;
      if (!exists) c.appendChild(s);
    }

    // show pre-roll ad overlay
    function showAd(){
      const ov = document.getElementById("adOverlay"),
            fr = document.getElementById("prerollFrame"),
            sk = document.getElementById("skipBtn");
      fr.src = AD_REDIRECT_URL;
      ov.style.display = "flex";
      ov.setAttribute("aria-hidden","false");
      sk.style.display = "none";
      clearTimeout(skipTimeout);
      skipTimeout = setTimeout(() => sk.style.display = "block", 7000);
    }

    // close pre-roll and then trigger adCallback
    function closeAd(){
      const ov = document.getElementById("adOverlay");
      ov.style.display = "none";
      ov.setAttribute("aria-hidden","true");
      clearTimeout(skipTimeout);
      const fr = document.getElementById("prerollFrame");
      fr.src = "about:blank";
      if (typeof adCallback === "function"){
        setTimeout(() => { adCallback(); adCallback = null; }, 80);
      }
    }

    // click on adOverlay background to open ad link
    document.getElementById("adOverlay").addEventListener("click", (e) => {
      if (e.target && e.target.id === 'skipBtn') return;
      window.open(AD_REDIRECT_URL, "_blank");
      closeAd();
    });

    // ESC to close overlay
    document.addEventListener('keydown', (e) => {
      if (e.key === "Escape"){
        const ov = document.getElementById("adOverlay");
        if (ov.style.display === "flex") closeAd();
      }
    });
  </script>
</body>
  </html>
